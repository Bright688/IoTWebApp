{% extends "base.html" %}

{% block title %}Security Assessment - IoT Security WebApp{% endblock %}

{% block content %}
<div class="container mx-auto py-10 px-6">
    <h1 class="text-3xl font-bold text-blue-600 text-center">IoT Security Assessment</h1>
    <p class="text-lg text-gray-700 text-center mt-2">Answer the following questions to evaluate your IoT security posture.</p>

    <form id="assessmentForm" class="mt-8 bg-white p-6 rounded-lg shadow-lg">
        {% for question in questions %}
        <div class="mb-6">
            <p class="text-lg font-semibold text-gray-800">{{ loop.index }}. {{ question.text }}</p>
            <div class="mt-2 space-y-2">
                {% for option in question.options %}
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" name="q{{ loop.parent.index }}" value="{{ option }}" class="hidden" required>
                    <span class="w-5 h-5 border-2 border-gray-400 rounded-full flex items-center justify-center">
                        <span class="w-3 h-3 bg-gray-400 rounded-full opacity-0 transition"></span>
                    </span>
                    <span class="text-gray-700">{{ option }}</span>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <button type="submit" class="mt-6 w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-500 transition">
            Submit Assessment
        </button>
    </form>

    <div id="feedback" class="mt-6 p-4 hidden bg-green-100 text-green-800 rounded-lg"></div>
</div>

<script>
document.getElementById("assessmentForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const answers = {};
    for (let [key, value] of formData.entries()) {
        answers[key] = value;
    }

    fetch("/api/assessment/submit", {
        method: "POST",
        body: JSON.stringify(answers),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById("feedback").innerText = "Your score: " + data.score + " / 10";
        document.getElementById("feedback").classList.remove("hidden");
    })
    .catch(error => console.error("Error:", error));
});
</script>
{% endblock %}